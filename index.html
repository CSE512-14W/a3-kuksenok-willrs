<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" href="rsrcs/d3.slider.css" />  
<style>

body, html {
  background: black;
  margin: 0;
  padding: 0;
}

#map {
  width: 100%;
  height: 100%;
}

.q0-9 { fill:rgb(247,251,255); }
.q1-9 { fill:rgb(222,235,247); }
.q2-9 { fill:rgb(198,219,239); }
.q3-9 { fill:rgb(158,202,225); }
.q4-9 { fill:rgb(107,174,214); }
.q5-9 { fill:rgb(66,146,198); }
.q6-9 { fill:rgb(33,113,181); }
.q7-9 { fill:rgb(8,81,156); }
.q8-9 { fill:rgb(8,48,107); }

</style>

<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="scripts/datamap.js"></script>
<script>

var map;

window.addEventListener('load', function() {
  var el = document.getElementById('map');
  map = new Datamap({
    element: document.getElementById('map'),
    fills: {
      defaultFill: '#333'
    },
    geographyConfig: {
      highlightOnHover: false,
      popupOnHover: false
    }
  });

  queue().defer(d3.json, 'data/ufo_metadata.json').await(bubble);
});

var bubble = function(error, ufos) {
  window.ufos = ufos;
  var locs = {};
  var bubbles = [];
  ufos.forEach(function(ufo) {
    if (!ufo[0] || ufo[0][0] === 0 || ufo[0][1] === 0 ||
        ufo[0][0] === undefined || ufo[0][1] === undefined) {
      return;
    }
    var key = ufo[0][0] + ',' + ufo[0][1]
    if (locs[key]) {
      bubbles[locs[key]].count += 1;
    } else {
      locs[key] = bubbles.length;
      bubbles.push({
        name: ufo[1],
        latitude: ufo[0][0],
        longitude: ufo[0][1],
        count: 1
      });
    }
  });
  bubbles.forEach(function(bubble) {
    bubble.radius = Math.sqrt(bubble.count);
  });
  map.bubbles(bubbles, {
    fillOpacity: 0.5,
    highlightBorderWidth: 1,
    borderWidth: 1,
    borderColor: "rgba(255, 255, 255, 0.5)"
  });
};

</script>
<div id='map'></div>
