<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" href="rsrcs/map.css" />
<style>

body, html {
  background: black;
  margin: 0;
  padding: 0;
}

#map {
  width: 500px;
  height: 500px;
  float:left;
}

div, svg {
  border:solid 1px red;
}

#barcharts{
  float:left;
  width:320px;
  padding-left:5px;
}

#barcharts svg {
  height:300px;
  width:100px;
  float:left;
}

#example{
  width:200px;
  color:#bbbbbb;
  padding:3px;
  padding-top:100px;
  float:left;
}

h1 {
  color:white;
}

  .bigsummary rect {
    fill: steelblue;
  }

  .bigsummary text {
    fill: white;
    font: 10px sans-serif;
    text-anchor: end;
  }
</style>

<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="scripts/d3.geo.zoom.js"></script>
<!--
<script src="scripts/datamap.js"></script>
<script>

var map;

window.addEventListener('load', function() {
  var el = document.getElementById('map');
  map = new Datamap({
    element: document.getElementById('map'),
    fills: {
      defaultFill: '#333'
    },
    geographyConfig: {
      highlightOnHover: false,
      popupOnHover: false
    }
  });

  queue().defer(d3.json, 'data/ufo_metadata.json').await(bubble);
});

var bubble = function(error, ufos) {
  window.ufos = ufos;
  var locs = {};
  var bubbles = [];
  ufos.forEach(function(ufo) {
    if (!ufo[0] || ufo[0][0] === 0 || ufo[0][1] === 0 ||
        ufo[0][0] === undefined || ufo[0][1] === undefined) {
      return;
    }
    var key = ufo[0][0] + ',' + ufo[0][1]
    if (locs[key]) {
      bubbles[locs[key]].count += 1;
    } else {
      locs[key] = bubbles.length;
      bubbles.push({
        name: ufo[1],
        latitude: ufo[0][0],
        longitude: ufo[0][1],
        count: 1
      });
    }
  });
  bubbles.forEach(function(bubble) {
    bubble.radius = Math.sqrt(bubble.count);
  });
  map.bubbles(bubbles, {
    fillOpacity: 0.5,
    highlightBorderWidth: 1,
    borderWidth: 1,
    borderColor: "rgba(255, 255, 255, 0.5)"
  });
};

</script>
-->
<script src="scripts/map.js"></script>
<div id="vis-main">
  <div id='map'></div>
  <div id='barcharts'>
    <h1 id="label">X of Y UFOs selected. Z mention a missile launch.</h1>
    <svg id="summary"></svg>
    <svg id="shapes"></svg>
    <svg id="years"></svg>
  </div>
  <div id="example">
  </div>
</div>
<button onclick="reloadUfoSummaries()" >Trigger Reload</button>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script>
// This lists all the possible states for the example detail and related
// variables
window.example_detail_state_enum = {
    OFF : 0,
    CURRENT_SELECTION : 1,   // From a selection, weighted by length
    INDIVIDUAL : 2,   // From a selection, weighted by length
}
window.example_detail_state = window.example_detail_state_enum.OFF;

setInterval(function(){recurringExampleReloader()},10000);

function recurringExampleReloader() {
  //Fade in/out
  // var mySquare=d3.select("example").text("hello!");
  //if (window.example_detail_state == window.example_detail_state_enum.CURRENT_SELECTION) {
    var currentdate = new Date();

    var nextExample = "Fetch a new example here!" +currentdate.getMinutes() + ":" + currentdate.getSeconds();
    $("#example").fadeOut(4000, function(){$("#example").text(nextExample)});
    console.log(nextExample);
  //}
}

window.addEventListener('load', function() {
    queue().defer(d3.json, 'data/ufo_metadata.json').await(initialLoad);
});

var initialLoad = function(error, ufos) {
  console.log("Initial loading...");
  window.ufo_stats = [
    {"Total" : ufos.length}
    // twhatever we have about read error stats...
    ]
}

// Fills in data for a UFO subset
function loadUfos(ufo_subset) {
  var big_summary
  ufos.forEach(function(ufo) {});
}

 var data = [
  {"label" : "total", "value" : 30},
  {"label" : "subset", "value" : 20}
  ];

var width = 420,
barHeight = 20;

var x = d3.scale.linear()
    .domain([0, d3.max(olddata)])
    .range([0, width]);



var chart = d3.select(".bigsummary")
    .attr("width", width)
    .attr("height", barHeight * data.length);

var bar = chart.selectAll("g")
    .data(data)
    .enter().append("g")
    .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });

bar.append("rect")
    .attr("width",  function(d) { return x(d["value"]); })
    .attr("height", barHeight - 1);

bar.append("text")
    .attr("x", function(d) { return x(d["value"]) - 3; })
    .attr("y", barHeight / 2)
    .attr("dy", ".35em")
    .text(function(d, i) { return d["label"] + ": " + d["value"]; });

d3.select('.bigsummary').on("click", function() {
  data.push({"label" : "new", "value": 10});
    console.log(data);
    
   // x.domain(d3.extent(data, function(d) { return d.x; }));
   // y.domain([0, d3.max(data, function(d) { return d.y; })]);

    //chart.selectAll("g").data(data);
    
    
    var chart = d3.select(".bigsummary")
        .attr("width", width)
        .attr("height", barHeight * data.length);
    
    var bar = chart.selectAll("g")
      .data(data)
      .enter().append("g")
      .attr("transform", function(d, i) { return "translate(0," + i * barHeight + ")"; });

  bar.append("rect")
      .attr("width",  function(d) { return x(d["value"]); })
      .attr("height", barHeight - 1);

  bar.append("text")
      .attr("x", function(d) { return x(d["value"]) - 3; })
      .attr("y", barHeight / 2)
      .attr("dy", ".35em")
    .text(function(d, i) { return d["label"] + ": " + d["value"]; });
    console.log(chart);
});

</script>
